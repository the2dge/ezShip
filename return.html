<!DOCTYPE html>
<html>
<head>
  <title>ezShip Return Page</title>
  <script>
    function getUrlParameter(name) {
      name = name.replace(/[\[]/, '\\[').replace(/[\]]/, '\\]');
      const regex = new RegExp('[\\?&]' + name + '=([^&#]*)');
      const results = regex.exec(window.location.search);
      return results === null ? '' : decodeURIComponent(results[1].replace(/\+/g, ' '));
    }

    function sendStoreDataToParent() {
      const stName = getUrlParameter('stName');
      const stAddr = getUrlParameter('stAddr');
      const stCate = getUrlParameter('stCate');
      const stCode = getUrlParameter('stCode');
      console.log("Address Confirm Button clicked!");
      if (stName && stAddr && stCate && stCode) {
        const storeData = {
          stName: stName,
          stAddr: stAddr,
          stCate: stCate,
          stCode: stCode
        };
        console.log("Sending store data to parent:", storeData); // Debugging log
        const parentWindow = window.opener || window.parent;
        parentWindow.postMessage(storeData, "https://the2dge.github.io/");
        
      }
    }

    window.onload = function() {
      const stName = getUrlParameter('stName');
      const stAddr = getUrlParameter('stAddr');
      const stCate = getUrlParameter('stCate');
      const stCode = getUrlParameter('stCode');

      if (stName && stAddr && stCate && stCode) {
        const shippingAddress = `${stName}, ${stAddr}, ${stCate} ${stCode}`;
        document.getElementById("storeInfo").innerText = `Selected Store: ${shippingAddress}`;
        document.getElementById("stName").innerText = `Store Name: ${stName}`;
        document.getElementById("stAddr").innerText = `Store Address: ${stAddr}`;
        document.getElementById("stCate").innerText = `Store Category: ${stCate}`;
        document.getElementById("stCode").innerText = `Store Code: ${stCode}`;
      } else {
        document.getElementById("storeInfo").innerText = `No store data found in URL parameters.`;
      }

      document.getElementById("addressConfirmedBtn").onclick = function() {
        sendStoreDataToParent();
        setTimeout(() => {
          window.close();
        }, 1000); // Give some time for the message to be processed
      };
    }
  </script>
</head>
<body>
  <h1>店家名稱</h1>
  <div id="storeInfo">Store information will be displayed here.</div>
  <div id="stName"></div>
  <div id="stAddr"></div>
  <div id="stCate"></div>
  
  <button id="addressConfirmedBtn">Confirm Address</button>
</body>
</html>
