<!DOCTYPE html>
<html>
<head>
  <title>ezShip Return Page</title>
  <script>
    function getUrlParameter(name) {
      name = name.replace(/[\[]/, '\\[').replace(/[\]]/, '\\]');
      const regex = new RegExp('[\\?&]' + name + '=([^&#]*)');
      const results = regex.exec(window.location.search);
      return results === null ? '' : decodeURIComponent(results[1].replace(/\+/g, ' '));
    }

    function updateParentPage() {
      const stName = getUrlParameter('stName');
      const stAddr = getUrlParameter('stAddr');
      const stCate = getUrlParameter('stCate');
      const stCode = getUrlParameter('stCode');

      if (stName && stAddr && stCate && stCode) {
        const shippingAddress = `${stName}, ${stAddr}, ${stCate} ${stCode}`;
        const parentWindow = window.opener || window.parent;
        parentWindow.document.getElementById("storeInfo").innerText = `Selected Store: ${shippingAddress}`;
        parentWindow.document.getElementById("shippingAddress").value = shippingAddress;
      }
    }

    window.onload = function() {
      const stName = getUrlParameter('stName');
      const stAddr = getUrlParameter('stAddr');
      const stCate = getUrlParameter('stCate');
      const stCode = getUrlParameter('stCode');

      if (stName && stAddr && stCate && stCode) {
        const shippingAddress = `${stName}, ${stAddr}, ${stCate} ${stCode}`;
        document.getElementById("storeInfo").innerText = `Selected Store: ${shippingAddress}`;
        document.getElementById("stName").innerText = `Store Name: ${stName}`;
        document.getElementById("stAddr").innerText = `Store Address: ${stAddr}`;
        document.getElementById("stCate").innerText = `Store Category: ${stCate}`;
        document.getElementById("stCode").innerText = `Store Code: ${stCode}`;
      } else {
        document.getElementById("storeInfo").innerText = `No store data found in URL parameters.`;
      }

      document.getElementById("addressConfirmedBtn").onclick = function() {
        updateParentPage();
        window.close();
      };
    }
  </script>
</head>
<body>
  <h1>取貨商店</h1>
  <div id="storeInfo">Store information will be displayed here.</div>
  <div id="stName"></div>
  <div id="stAddr"></div>

  <button id="addressConfirmedBtn">Confirm Address</button>
</body>
</html>
